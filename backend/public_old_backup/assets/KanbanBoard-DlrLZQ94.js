import{r as e,j as a,k as r,S as s,A as t,M as n,F as i,R as d,c as l,B as o,D as c,E as u,l as h,G as m,H as x}from"./vendor-Dx9LGgEc.js";import{P as p,L as j,A as b,f}from"./index-CzAoGVZ8.js";import"./charts-CmGcY8O5.js";const D=({groupBy:D="status",sortBy:E="orderDate",filterStatus:N="all",onPOSelect:I,onStatusChange:y,onComponentRender:v,className:g=""})=>{const C=e.useRef(performance.now()),[k,S]=e.useState([]),[w,L]=e.useState(!0),[O,P]=e.useState(D),[A,F]=e.useState(E),[R,B]=e.useState(null),[H,M]=e.useState(!1),[V,T]=e.useState("");p.CONFIRMED,p.SHIPPED,p.DELIVERED,p.UPLOADED,p.INVOICED,p.CANCELLED;e.useEffect((()=>{const e=performance.now();return C.current=e,U(),()=>{j.debug(`[KANBAN] Component rerendered in ${performance.now()-e}ms`)}}),[O,A]);const U=async()=>{L(!0);try{const e=new Date,a=new Date(e);a.setDate(a.getDate()-30);const r=await b.fetchPOs({startDate:a.toISOString(),endDate:e.toISOString(),limit:100});if(r&&r.data&&r.data.length>0){j.info(`Found ${r.data.length} POs for kanban board`);const e=G(r.data,O,A);if(S(e),L(!1),v){const e=performance.now()-C.current;v(e)}}else j.info("No POs found in API"),S([]),B("No purchase order data found in the selected filters."),L(!1)}catch(e){j.error("Error fetching purchase orders:",e),B(`Failed to load kanban board data: ${e instanceof Error?e.message:String(e)}`),S([]),B("Error loading data: check your network connection"),L(!1)}},G=(e,a,r)=>{let s={},t=[],n=e;if("all"!==N&&(n=e.filter((e=>"open"===N?[p.UPLOADED,p.CONFIRMED].includes(e.header.status):"completed"!==N||[p.DELIVERED,p.INVOICED].includes(e.header.status)))),"status"===a){const e=[p.UPLOADED,p.CONFIRMED,p.SHIPPED,p.INVOICED,p.DELIVERED,p.CANCELLED];e.forEach((e=>{s[e]=[]})),n.forEach((e=>{const a=e.header.status;s[a]||(s[a]=[]),s[a].push(e)})),t=e.map((e=>({id:e,title:e,items:$(s[e]||[],r),color:z(e)})))}else"supplier"===a||"location"===a?(n.forEach((e=>{const a=e.header.syscoLocation.name;s[a]||(s[a]=[]),s[a].push(e)})),t=Object.keys(s).map((e=>({id:e,title:e,items:$(s[e],r)})))):"buyer"===a&&(n.forEach((e=>{const a=`${e.header.buyerInfo.firstName} ${e.header.buyerInfo.lastName}`;s[a]||(s[a]=[]),s[a].push(e)})),t=Object.keys(s).map((e=>({id:e,title:e,items:$(s[e],r)}))));return t},$=(e,a)=>[...e].sort(((e,r)=>{var s,t;switch(a){case"orderDate":return new Date(e.header.orderDate).getTime()-new Date(r.header.orderDate).getTime();case"amount":return(r.totalCost||0)-(e.totalCost||0);case"dueDate":return((null==(s=e.header.deliveryInfo)?void 0:s.date)?new Date(e.header.deliveryInfo.date).getTime():Number.MAX_SAFE_INTEGER)-((null==(t=r.header.deliveryInfo)?void 0:t.date)?new Date(r.header.deliveryInfo.date).getTime():Number.MAX_SAFE_INTEGER);case"priority":const a={[p.UPLOADED]:1,[p.CONFIRMED]:2,[p.SHIPPED]:3,[p.INVOICED]:4,[p.DELIVERED]:5,[p.CANCELLED]:6};return a[e.header.status]-a[r.header.status];default:return 0}})),z=e=>{switch(e){case p.UPLOADED:return"#FF9800";case p.CONFIRMED:return"#2196F3";case p.SHIPPED:return"#673AB7";case p.INVOICED:return"#3F51B5";case p.DELIVERED:return"#4CAF50";case p.CANCELLED:return"#F44336";default:return"#9E9E9E"}},K=e=>{if(!e)return"N/A";try{return f(new Date(e),"MMM d, yyyy")}catch(a){return e}},_=e=>{A!==e&&F(e)},X=e=>{O!==e&&P(e)};if(w)return a.jsx("div",{className:`kanban-board ${g}`,children:a.jsx(r,{className:"h-100 shadow-sm",children:a.jsx(r.Body,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"500px"},children:a.jsxs("div",{className:"text-center",children:[a.jsx(s,{animation:"border",variant:"primary"}),a.jsx("p",{className:"mt-3 text-muted",children:"Loading kanban board..."})]})})})});if(R)return a.jsx("div",{className:`kanban-board ${g}`,children:a.jsx(r,{className:"h-100 shadow-sm",children:a.jsx(r.Body,{children:a.jsxs(t,{variant:"danger",children:[a.jsx(t.Heading,{children:"Failed to load kanban board"}),a.jsx("p",{children:R})]})})})});const W=a.jsxs(n,{show:H,onHide:()=>M(!1),size:"lg",children:[a.jsx(n.Header,{closeButton:!0,children:a.jsx(n.Title,{children:"Filter Purchase Orders"})}),a.jsx(n.Body,{children:a.jsxs(i,{children:[a.jsxs(d,{className:"mb-3",children:[a.jsx(l,{md:6,children:a.jsxs(i.Group,{controlId:"filter-keyword",children:[a.jsx(i.Label,{children:"Search Keyword"}),a.jsx(i.Control,{type:"text",placeholder:"Enter PO number, supplier, etc.",value:V,onChange:e=>T(e.target.value)})]})}),a.jsx(l,{md:6,children:a.jsxs(i.Group,{controlId:"filter-status",children:[a.jsx(i.Label,{children:"Status"}),a.jsxs(i.Select,{children:[a.jsx("option",{value:"",children:"All Statuses"}),a.jsx("option",{value:p.UPLOADED,children:"Uploaded"}),a.jsx("option",{value:p.CONFIRMED,children:"Confirmed"}),a.jsx("option",{value:p.SHIPPED,children:"Shipped"}),a.jsx("option",{value:p.INVOICED,children:"Invoiced"}),a.jsx("option",{value:p.DELIVERED,children:"Delivered"}),a.jsx("option",{value:p.CANCELLED,children:"Cancelled"})]})]})})]}),a.jsxs(d,{className:"mb-3",children:[a.jsx(l,{md:6,children:a.jsxs(i.Group,{controlId:"filter-date-from",children:[a.jsx(i.Label,{children:"From Date"}),a.jsx(i.Control,{type:"date"})]})}),a.jsx(l,{md:6,children:a.jsxs(i.Group,{controlId:"filter-date-to",children:[a.jsx(i.Label,{children:"To Date"}),a.jsx(i.Control,{type:"date"})]})})]})]})}),a.jsxs(n.Footer,{children:[a.jsx(o,{variant:"secondary",onClick:()=>M(!1),children:"Cancel"}),a.jsx(o,{variant:"primary",onClick:()=>{U(),M(!1)},children:"Apply Filters"})]})]});return a.jsx("div",{className:`kanban-board ${g}`,children:a.jsxs(r,{className:"h-100 shadow-sm",children:[a.jsxs(r.Header,{className:"d-flex justify-content-between align-items-center",children:[a.jsxs("h5",{className:"mb-0",children:[a.jsx("i",{className:"bi bi-kanban me-2"}),"Kanban Board"]}),a.jsxs("div",{className:"d-flex gap-2",children:[a.jsxs(c,{children:[a.jsxs(c.Toggle,{variant:"outline-secondary",size:"sm",children:[a.jsx("i",{className:"bi bi-sort-down me-1"})," Sort: ","orderDate"===A?"Order Date":"amount"===A?"Amount":"dueDate"===A?"Due Date":"Priority"]}),a.jsxs(c.Menu,{children:[a.jsx(c.Item,{active:"orderDate"===A,onClick:()=>_("orderDate"),children:"Order Date"}),a.jsx(c.Item,{active:"amount"===A,onClick:()=>_("amount"),children:"Amount"}),a.jsx(c.Item,{active:"dueDate"===A,onClick:()=>_("dueDate"),children:"Due Date"}),a.jsx(c.Item,{active:"priority"===A,onClick:()=>_("priority"),children:"Priority"})]})]}),a.jsxs(o,{variant:"outline-primary",size:"sm",onClick:()=>{j.debug("Opening filter modal"),M(!0)},children:[a.jsx("i",{className:"bi bi-filter me-1"})," Filter"]})]}),a.jsx("div",{className:"ms-auto",children:a.jsxs(c,{children:[a.jsxs(c.Toggle,{variant:"outline-secondary",size:"sm",children:[a.jsx("i",{className:"bi bi-layout-three-columns me-1"})," Group By: ","status"===O?"Status":"supplier"===O?"Supplier":"location"===O?"Location":"Buyer"]}),a.jsxs(c.Menu,{children:[a.jsx(c.Item,{active:"status"===O,onClick:()=>X("status"),children:"Status"}),a.jsx(c.Item,{active:"supplier"===O,onClick:()=>X("supplier"),children:"Supplier"}),a.jsx(c.Item,{active:"location"===O,onClick:()=>X("location"),children:"Location"}),a.jsx(c.Item,{active:"buyer"===O,onClick:()=>X("buyer"),children:"Buyer"})]})]})})]}),a.jsx(r.Body,{className:"p-0",children:a.jsx("div",{className:"kanban-container p-2",children:a.jsx(u,{onDragEnd:e=>{const{source:a,destination:r}=e;if(!r)return;if(a.droppableId===r.droppableId&&a.index===r.index)return;const s=k.find((e=>e.id===a.droppableId)),t=k.find((e=>e.id===r.droppableId));if(!s||!t)return;const n=[...k],i=[...s.items],d=s===t?i:[...t.items],[l]=i.splice(a.index,1);if("status"===O&&a.droppableId!==r.droppableId&&y){const e=r.droppableId;l.header.status=e,y(l.header.poNumber,e)}d.splice(r.index,0,l);const o=n.findIndex((e=>e.id===a.droppableId)),c=n.findIndex((e=>e.id===r.droppableId));n[o]={...s,items:i},o!==c&&(n[c]={...t,items:d}),S(n)},children:a.jsx("div",{className:"d-flex kanban-columns-container overflow-auto px-2 py-3",style:{minHeight:"500px"},children:k.map((e=>a.jsxs("div",{className:"kanban-column mx-2",style:{minWidth:"300px"},children:[a.jsx("div",{className:"kanban-column-header p-2 rounded-top",style:{backgroundColor:e.color||"#f8f9fa",color:e.color?"#fff":"#212529"},children:a.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsx("h6",{className:"mb-0",children:e.title}),a.jsx(h,{bg:"light",text:"dark",children:e.items.length})]})}),a.jsx(m,{droppableId:e.id,children:r=>a.jsxs("div",{className:"kanban-column-content p-2 bg-light rounded-bottom",...r.droppableProps,ref:r.innerRef,style:{minHeight:"200px"},children:[e.items.map(((e,r)=>a.jsx(x,{draggableId:e.header.poNumber,index:r,children:r=>{return a.jsxs("div",{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,className:"kanban-card mb-2 p-3 bg-white rounded shadow-sm",onClick:()=>{return a=e.header.poNumber,j.debug("KanbanBoard.handleCardClick called with poNumber:",a),void(I&&I(a));var a},children:[a.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[a.jsx("h6",{className:"mb-0",children:e.header.poNumber}),a.jsx(h,{bg:z(e.header.status).replace("#",""),style:{backgroundColor:z(e.header.status)},children:e.header.status})]}),a.jsx("div",{className:"small mb-2 fw-bold",children:e.header.syscoLocation.name}),a.jsxs("div",{className:"d-flex justify-content-between text-muted small",children:[a.jsxs("div",{children:[a.jsx("i",{className:"bi bi-calendar3 me-1"}),K(e.header.orderDate)]}),a.jsxs("div",{children:[a.jsx("i",{className:"bi bi-cash me-1"}),(s=e.totalCost,void 0===s?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s))]})]})]});var s}},e.header.poNumber))),r.placeholder]})})]},e.id)))})})})}),W]})})};export{D as default};
//# sourceMappingURL=KanbanBoard-DlrLZQ94.js.map
