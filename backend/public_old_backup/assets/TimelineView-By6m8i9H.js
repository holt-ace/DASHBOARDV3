const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mockData-DqbLeMr5.js","assets/index-CzAoGVZ8.js","assets/vendor-Dx9LGgEc.js","assets/charts-CmGcY8O5.js","assets/charts-CIGW-MKW.css","assets/index-Dp6NK7LJ.css"])))=>i.map(i=>d[i]);
import{D as e,a as t,L as r,A as a,_ as s,P as n,f as i,d as l}from"./index-CzAoGVZ8.js";import{r as o,j as c,k as d,B as m,D as u,O as h,J as p,S as g,A as x}from"./vendor-Dx9LGgEc.js";import"./charts-CmGcY8O5.js";const E=({timeRange:E="month",groupBy:N="none",onTimeRangeChange:y,milestoneType:b="all",onPOSelect:I,onComponentRender:f,className:v=""})=>{const j=o.useRef(0);o.useEffect((()=>(e.componentDidMount("TimelineView",{timeRange:E,groupBy:N,milestoneType:b}),()=>{e.componentWillUnmount("TimelineView")})),[E,N,b]);const D=o.useRef(null),[w,C]=o.useState([]),[M,T]=o.useState({start:new Date,end:t(new Date,30)}),[S,L]=o.useState(E),[k,O]=o.useState(N),[P,F]=o.useState(1),[R,$]=o.useState(!0),[V,B]=o.useState(null);o.useEffect((()=>{try{j.current=performance.now(),r.debug("[TIMELINE] Settings changed, fetching new data",{timeRange:S,groupBy:k,milestoneType:b}),A()}catch(e){r.error("[TIMELINE] Error in settings change effect:",e)}}),[S,k,b]);const A=async()=>{r.debug("[TIMELINE] Starting data fetch"),e.dataFetch("TimelineView","PurchaseOrders","start",{timeRange:S,groupBy:k}),$(!0);const t=new Date;let n=new Date;try{switch(S){case"month":case"custom":n.setMonth(n.getMonth()-1);break;case"quarter":n.setMonth(n.getMonth()-3);break;case"6months":n.setMonth(n.getMonth()-6);break;case"year":n.setFullYear(n.getFullYear()-1)}T({start:n,end:t});try{r.debug("[TIMELINE] Calling API to fetch POs",{startDate:n.toISOString(),endDate:t.toISOString()});const l=await a.fetchPOs({startDate:n.toISOString(),endDate:t.toISOString(),limit:100});if(l&&l.data&&l.data.length>0){r.info(`[TIMELINE] Found ${l.data.length} POs for timeline`);const t=z(l.data);try{const r=U(t,k,b);C(r);const a=performance.now()-j.current;f&&f(a),e.visualizationRendered("TimelineView",r.length,performance.now()-j.current),e.dataFetch("TimelineView","PurchaseOrders","success",{rowCount:r.length,poCount:l.data.length}),B(null)}catch(i){r.error("[TIMELINE] Error creating timeline data:",i),B("Error processing timeline data: "+String(i)),e.renderError("TimelineView-createData",i)}}else s((()=>import("./mockData-DqbLeMr5.js")),__vite__mapDeps([0,1,2,3,4,5])).then((e=>{r.info("[TIMELINE] Using mock data for development");const t=e.mockPurchaseOrders,a=U(t,k,b);C(a),B("No PO data found. Using sample data for development purposes only.")})).catch((e=>B("Error loading mock data: "+String(e)))),e.dataFetch("TimelineView","PurchaseOrders","error",{error:"No data found"})}catch(l){r.error("[TIMELINE] API error fetching purchase orders:",l),B("Failed to load timeline data: "+(l instanceof Error?l.message:String(l))),e.dataFetch("TimelineView","PurchaseOrders","error",{error:l instanceof Error?l.message:String(l)})}}catch(o){r.error("[TIMELINE] Unexpected error in fetchPurchaseOrders:",o),B("Unexpected error: "+String(o))}finally{$(!1)}},z=o.useCallback((e=>{try{return e.map((e=>{if(e.history&&e.history.length>0)return e;const t=H(e);return{...e,history:t}}))}catch(t){return r.error("[TIMELINE] Error enriching purchase orders:",t),e}}),[]),H=o.useCallback((e=>{var a,s;if(!e.header||!e.header.orderDate)return r.warn("[TIMELINE] Cannot generate history for invalid PO:",(null==(a=e.header)?void 0:a.poNumber)||"unknown"),[];try{const r=[],a=new Date(e.header.orderDate);switch(r.push({status:n.UPLOADED,timestamp:a.toISOString(),user:e.header.buyerInfo?`${e.header.buyerInfo.firstName} ${e.header.buyerInfo.lastName}`:"System"}),e.header.status){case n.CONFIRMED:r.push({status:n.CONFIRMED,timestamp:t(a,2).toISOString(),user:"System"});break;case n.SHIPPED:r.push({status:n.CONFIRMED,timestamp:t(a,2).toISOString(),user:"System"}),r.push({status:n.SHIPPED,timestamp:t(a,4).toISOString(),user:"System"});break;case n.DELIVERED:case n.INVOICED:r.push({status:n.CONFIRMED,timestamp:t(a,2).toISOString(),user:"System"}),r.push({status:n.SHIPPED,timestamp:t(a,4).toISOString(),user:"System"}),r.push({status:n.DELIVERED,timestamp:t(a,8).toISOString(),user:"System"}),e.header.status===n.INVOICED&&r.push({status:n.INVOICED,timestamp:t(a,10).toISOString(),user:"System"});break;case n.CANCELLED:r.push({status:n.CANCELLED,timestamp:t(a,1).toISOString(),user:"System"})}return r}catch(i){return r.error("[TIMELINE] Error generating history for PO:",(null==(s=e.header)?void 0:s.poNumber)||"unknown",i),[]}}),[]),U=o.useCallback(((t,a,s)=>{var i,l,o,c;const d=performance.now();r.debug("[TIMELINE] Creating timeline data",{poCount:t.length,groupBy:a,eventType:s});const m=[];try{for(const a of t)try{if(!a.history||0===a.history.length){r.warn(`[TIMELINE] PO ${(null==(i=a.header)?void 0:i.poNumber)||"unknown"} has no history data`);continue}if(!a.header){r.warn("[TIMELINE] PO missing header information",a);continue}const e=[...a.history].sort(((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())),t=e[0],n=e[e.length-1];if(!t||!n){r.warn("[TIMELINE] Invalid history data for PO",a.header.poNumber);continue}const c=new Date(t.timestamp),d=new Date(n.timestamp);"all"!==s&&"status"!==s||(m.push({id:`${a.header.poNumber}-main`,poNumber:a.header.poNumber,label:`${a.header.poNumber} (${a.header.status})`,startDate:c,endDate:d,status:a.header.status,milestoneType:"status"}),e.forEach(((e,t)=>{0!==t&&m.push({id:`${a.header.poNumber}-status-${t}`,poNumber:a.header.poNumber,label:e.status,startDate:new Date(e.timestamp),endDate:null,status:e.status,milestoneType:"status",details:e.notes})}))),"all"!==s&&"delivery"!==s||!(null==(l=a.header.deliveryInfo)?void 0:l.date)||m.push({id:`${a.header.poNumber}-delivery`,poNumber:a.header.poNumber,label:"Expected Delivery",startDate:new Date(a.header.deliveryInfo.date),endDate:null,status:a.header.status,milestoneType:"delivery"}),"all"!==s&&"payment"!==s||!(null==(o=a.invoice)?void 0:o.dueDate)||m.push({id:`${a.header.poNumber}-payment`,poNumber:a.header.poNumber,label:"Payment Due",startDate:new Date(a.invoice.dueDate),endDate:null,status:a.header.status,milestoneType:"payment"})}catch(u){r.error(`[TIMELINE] Error processing PO ${(null==(c=a.header)?void 0:c.poNumber)||"unknown"}:`,u)}let e=[];try{if("none"===a){e=[...new Set(m.map((e=>e.poNumber)))].map((e=>{const t=m.filter((t=>t.poNumber===e));return{id:e,label:e,events:t,isExpanded:!0}}))}else if("status"===a){e=Object.values(n).map((e=>{const t=m.filter((t=>{if(null!==t.endDate)return t.status===e;{const r=m.find((e=>e.poNumber===t.poNumber&&null!==e.endDate));return r&&r.status===e}}));return t.length>0?{id:e,label:e,events:t,isExpanded:!0}:null})).filter((e=>null!==e))}else if("supplier"===a||"location"===a){e=["Denver Warehouse","Seattle Distribution","Atlanta Hub","Chicago Distribution"].map((e=>{const t=m.filter((t=>t.poNumber.includes(e.substring(0,3))));return{id:e,label:e,events:t,isExpanded:!0}}))}}catch(h){r.error("[TIMELINE] Error grouping timeline data:",h);e=[...new Set(m.map((e=>e.poNumber)))].map((e=>({id:e,label:e,events:m.filter((t=>t.poNumber===e)),isExpanded:!0})))}const p=e.filter((e=>e.events&&e.events.length>0)),g=performance.now();return r.debug("[TIMELINE] Timeline data creation complete",{executionTime:`${(g-d).toFixed(2)}ms`,eventCount:m.length,rowCount:p.length}),p}catch(p){return r.error("[TIMELINE] Critical error creating timeline data:",p),e.renderError("TimelineView-createTimelineData",p),[]}}),[]),_=(e,t,a,s)=>{try{const r=l(s,a)||1,n=Math.max(0,l(e,a))/r*100;if(t){let a=l(t,e);0===a&&(a=.5);return{left:`${n}%`,width:`${a/r*100}%`}}return{left:`${n}%`,width:"auto"}}catch(n){return r.error("[TIMELINE] Error calculating position:",n),{left:"0%",width:"auto"}}},Y=o.useCallback((e=>{try{return i(e,"MMM d, yyyy")}catch(t){return"Invalid date"}}),[]),q=e=>{F((t=>{const r="in"===e?t+.5:t-.5;return Math.max(.5,Math.min(3,r))}))},W=o.useCallback((e=>{try{r.debug("[TIMELINE] Time range changing to:",e),L(e),y&&(r.debug("[TIMELINE] Calling parent onTimeRangeChange with:",e),y(e))}catch(t){r.error("[TIMELINE] Error changing time range:",t)}}),[y]),Z=o.useCallback((e=>{try{r.debug("[TIMELINE] Grouping changing to:",e),$(!0),k!==e&&(O(e),A())}catch(t){r.error("[TIMELINE] Error changing grouping:",t),$(!1)}}),[k,A]),G=o.useCallback(((e,t)=>{if("delivery"===t)return"#FF9800";if("payment"===t)return"#9C27B0";switch(e){case n.UPLOADED:return"#FF9800";case n.CONFIRMED:return"#2196F3";case n.SHIPPED:return"#673AB7";case n.INVOICED:return"#3F51B5";case n.DELIVERED:return"#4CAF50";case n.CANCELLED:return"#F44336";default:return"#9E9E9E"}}),[]),X=o.useCallback((e=>{try{r.debug("[TIMELINE] Event click on PO:",e),I&&I(e)}catch(t){r.error("[TIMELINE] Error handling event click:",t)}}),[I]),J=o.useCallback((()=>{try{const e=l(M.end,M.start)||1;let r=[],a=1;e>90?a=7:e>30&&(a=2);for(let s=0;s<=e;s+=a){const a=t(M.start,s),n=s/e*100;r.push(c.jsx("div",{className:"timeline-day-marker",style:{left:`${n}%`,position:"absolute"},children:i(a,"MMM d")},`day-${s}`))}return r}catch(e){return r.error("[TIMELINE] Error generating day markers:",e),[]}}),[M.start,M.end]),K=o.useCallback((e=>{try{C((t=>t.map((t=>t.id===e?{...t,isExpanded:!t.isExpanded}:t))))}catch(t){r.error("[TIMELINE] Error toggling row expansion:",t)}}),[]),Q=o.useMemo((()=>c.jsxs(d.Header,{className:"d-flex justify-content-between align-items-center",children:[c.jsxs("h5",{className:"mb-0",children:[c.jsx("i",{className:"bi bi-bar-chart-steps me-2"}),"Timeline View"]}),c.jsxs("div",{className:"d-flex gap-2",children:[c.jsxs("div",{className:"btn-group me-2",role:"group","aria-label":"Zoom controls",children:[c.jsx(m,{variant:"outline-secondary",title:"Zoom In",size:"sm",onClick:()=>q("in"),disabled:P>=3,children:c.jsx("i",{className:"bi bi-zoom-in"})}),c.jsx(m,{variant:"outline-secondary",title:"Zoom Out",size:"sm",onClick:()=>q("out"),disabled:P<=.5,children:c.jsx("i",{className:"bi bi-zoom-out"})})]}),c.jsxs(u,{children:[c.jsxs(u.Toggle,{variant:"outline-secondary",size:"sm",children:[c.jsx("i",{className:"bi bi-clock-history me-1"}),"month"===S?"Last 30 Days":"quarter"===S?"Last 90 Days":"6months"===S?"Last 6 Months":"Last Year"]}),c.jsxs(u.Menu,{children:[c.jsx(u.Item,{active:"month"===S,onClick:()=>W("month"),children:"Last 30 Days"}),c.jsx(u.Item,{active:"quarter"===S,onClick:()=>W("quarter"),children:"Last 90 Days"}),c.jsx(u.Item,{active:"6months"===S,onClick:()=>W("6months"),children:"Last 6 Months"}),c.jsx(u.Item,{active:"year"===S,onClick:()=>W("year"),children:"Last Year"})]})]}),c.jsxs(u,{className:"me-2",children:[c.jsxs(u.Toggle,{variant:"outline-secondary",size:"sm",children:[c.jsx("i",{className:"bi bi-collection me-1"})," Group: ","none"===k?"None":k]}),c.jsxs(u.Menu,{children:[c.jsx(u.Item,{active:"none"===k,onClick:()=>Z("none"),children:"None"}),c.jsx(u.Item,{active:"status"===k,onClick:()=>Z("status"),children:"By Status"}),c.jsx(u.Item,{active:"supplier"===k,onClick:()=>Z("supplier"),children:"By Supplier"}),c.jsx(u.Item,{active:"location"===k,onClick:()=>Z("location"),children:"By Location"})]})]}),c.jsxs(m,{variant:"outline-primary",size:"sm",onClick:A,children:[c.jsx("i",{className:"bi bi-sliders me-1"})," Filter"]})]})]})),[S,W,k,Z,P,A]),ee=o.useCallback((({rows:e})=>e.map((e=>c.jsxs("div",{className:"timeline-row-container mb-2",children:[c.jsxs("div",{className:"timeline-row d-flex py-2 border-bottom",children:[c.jsxs("div",{className:"timeline-legend d-flex align-items-center me-3",style:{minWidth:"150px"},children:[c.jsx(m,{variant:"link",className:"p-0 me-2",onClick:()=>K(e.id),children:c.jsx("i",{className:"bi "+(e.isExpanded?"bi-chevron-down":"bi-chevron-right")})}),c.jsx("span",{className:"fw-bold",children:e.label})]}),c.jsxs("div",{className:"timeline-grid position-relative flex-grow-1",style:{transform:`scaleX(${P})`,transformOrigin:"left",height:"30px"},children:[e.events.filter((e=>null!==e.endDate)).map((e=>{try{const r=_(e.startDate,e.endDate||t(e.startDate,1),M.start,M.end);return c.jsx(h,{placement:"top",overlay:c.jsxs(p,{children:[e.label,c.jsx("br",{}),"From: ",Y(e.startDate),c.jsx("br",{}),"To: ",e.endDate?Y(e.endDate):"N/A"]}),children:c.jsx("div",{className:"timeline-event position-absolute rounded",style:{...r,top:"5px",height:"20px",backgroundColor:G(e.status,e.milestoneType),cursor:"pointer"},onClick:()=>X(e.poNumber)})},e.id)}catch(a){return r.error("[TIMELINE] Error rendering event:",a),null}})),e.events.filter((e=>null===e.endDate)).map((e=>{try{const t=_(e.startDate,null,M.start,M.end);return c.jsx(h,{placement:"top",overlay:c.jsxs(p,{children:[e.label,c.jsx("br",{}),"Date: ",Y(e.startDate),e.details?c.jsxs(c.Fragment,{children:[c.jsx("br",{}),e.details]}):null]}),children:c.jsx("div",{className:"timeline-milestone position-absolute",style:{...t,top:"10px",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:G(e.status,e.milestoneType),cursor:"pointer",border:"1px solid white"},onClick:()=>X(e.poNumber)})},e.id)}catch(t){return r.error("[TIMELINE] Error rendering milestone:",t),null}}))]})]}),e.isExpanded&&c.jsx("div",{className:"timeline-row-details",children:c.jsx("div",{className:"ps-5 pt-2 pb-3",children:c.jsxs("div",{className:"small text-muted",children:["Contains ",e.events.filter((e=>null!==e.endDate)).length," PO bars and"," ",e.events.filter((e=>null===e.endDate)).length," milestones"]})})})]},e.id)))),[_,M.start,M.end,Y,G,X,K,P]),te=o.useMemo((()=>c.jsxs("div",{className:"timeline-legend-container d-flex justify-content-center mt-3 mb-2 gap-4",children:[c.jsxs("div",{className:"d-flex align-items-center",children:[c.jsx("div",{className:"rounded me-2",style:{width:"20px",height:"10px",backgroundColor:G(n.CONFIRMED,"status")}}),c.jsx("span",{className:"small",children:"PO Duration"})]}),c.jsxs("div",{className:"d-flex align-items-center",children:[c.jsx("div",{className:"rounded-circle me-2",style:{width:"10px",height:"10px",backgroundColor:G(n.CONFIRMED,"status")}}),c.jsx("span",{className:"small",children:"Status Change"})]}),c.jsxs("div",{className:"d-flex align-items-center",children:[c.jsx("div",{className:"rounded-circle me-2",style:{width:"10px",height:"10px",backgroundColor:G(n.CONFIRMED,"delivery")}}),c.jsx("span",{className:"small",children:"Delivery Milestone"})]}),c.jsxs("div",{className:"d-flex align-items-center",children:[c.jsx("div",{className:"rounded-circle me-2",style:{width:"10px",height:"10px",backgroundColor:G(n.CONFIRMED,"payment")}}),c.jsx("span",{className:"small",children:"Payment Milestone"})]})]})),[G]);return c.jsx("div",{className:`timeline-view ${v}`,children:c.jsxs(d,{className:"h-100 shadow-sm",children:[Q,R?c.jsx(d.Body,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"500px"},children:c.jsxs("div",{className:"text-center",children:[c.jsx(g,{animation:"border",variant:"primary"}),c.jsx("p",{className:"mt-3 text-muted",children:"Loading timeline data..."})]})}):V&&0===w.length?c.jsx(d.Body,{children:c.jsxs(x,{variant:"danger",children:[c.jsx(x.Heading,{children:"Failed to load timeline"}),c.jsx("p",{children:V}),c.jsx("div",{className:"d-flex justify-content-end",children:c.jsx(m,{variant:"outline-danger",size:"sm",onClick:A,children:"Retry"})})]})}):c.jsxs(d.Body,{className:"p-0",children:[c.jsxs("div",{className:"timeline-container p-3",children:[c.jsx("div",{className:"timeline-header px-4 py-2 border-bottom",children:c.jsxs("div",{className:"timeline-row d-flex",children:[c.jsx("div",{className:"timeline-legend me-3",style:{minWidth:"150px"},children:c.jsx("strong",{children:"Timeline"})}),c.jsx("div",{className:"timeline-grid position-relative flex-grow-1",children:J()})]})}),c.jsx("div",{className:"timeline-body",ref:D,style:{overflowX:"auto",overflowY:"auto",maxHeight:"600px"},children:w.length>0?c.jsx(ee,{rows:w}):c.jsx("div",{className:"p-5 text-center",children:c.jsx("p",{className:"text-muted",children:"No data to display in the selected time range."})})})]}),te]})]})})};export{E as default};
//# sourceMappingURL=TimelineView-By6m8i9H.js.map
