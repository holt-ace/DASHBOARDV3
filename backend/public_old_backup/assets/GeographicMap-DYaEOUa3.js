import{r as e,j as n,k as a,S as t,l as s,B as r,F as i,D as l,A as o}from"./vendor-Dx9LGgEc.js";import{A as c,L as d,P as u}from"./index-CzAoGVZ8.js";import{L as m}from"./charts-CmGcY8O5.js";const h=({region:h="all",deliveryStatus:p="all",timePeriod:g="current-month",onPOSelect:x,onBatchSelectionChange:f,onComponentRender:b,className:v=""})=>{const j=e.useRef(0),y=e.useRef(null),[N,w]=e.useState(null),[k,C]=e.useState(null),[S,L]=e.useState(null),[D,E]=e.useState(!0),[I,M]=e.useState(!1),[P,F]=e.useState(null),[z,A]=e.useState(null),[O,$]=e.useState([]),[B,R]=e.useState([]),[T,V]=e.useState(!1),[U,G]=e.useState(0),[q,H]=e.useState(h),[Y,Z]=e.useState(p),[W,J]=e.useState(g),[K,Q]=e.useState(""),X=e=>{switch(e){case"north-america":return{center:[39.8283,-98.5795],zoom:4};case"europe":return{center:[54.526,15.2551],zoom:4};case"asia-pacific":return{center:[34.0479,100.6197],zoom:3};case"latin-america":return{center:[-8.7832,-55.4915],zoom:4};default:return{center:[20,0],zoom:2}}},_=async e=>{try{await new Promise((e=>setTimeout(e,10)));const n=e.toLowerCase();return e?n.includes("denver")||n.includes("colorado")?{lat:39.7392,lng:-104.9903}:n.includes("seattle")||n.includes("washington")?{lat:47.6062,lng:-122.3321}:n.includes("atlanta")||n.includes("georgia")?{lat:33.749,lng:-84.388}:n.includes("chicago")||n.includes("illinois")?{lat:41.8781,lng:-87.6298}:n.includes("new york")||n.includes("ny")?{lat:40.7128,lng:-74.006}:n.includes("los angeles")||n.includes("la")?{lat:34.0522,lng:-118.2437}:n.includes("miami")||n.includes("florida")?{lat:25.7617,lng:-80.1918}:n.includes("boston")||n.includes("massachusetts")?{lat:42.3601,lng:-71.0589}:n.includes("london")||n.includes("uk")?{lat:51.5074,lng:-.1278}:n.includes("paris")||n.includes("france")?{lat:48.8566,lng:2.3522}:n.includes("tokyo")||n.includes("japan")?{lat:35.6762,lng:139.6503}:n.includes("sydney")||n.includes("australia")?{lat:-33.8688,lng:151.2093}:n.includes("sao paulo")||n.includes("brazil")?{lat:-23.5505,lng:-46.6333}:n.includes("mexico")?{lat:19.4326,lng:-99.1332}:n.includes("ca")||n.includes("tx")||n.includes("ny")?{lat:5*Math.random()-2.5+37.0902,lng:10*Math.random()-5-95.7129}:n.includes("uk")||n.includes("germany")||n.includes("france")?{lat:5*Math.random()-2.5+50,lng:10*Math.random()-5+10}:n.includes("china")||n.includes("japan")||n.includes("australia")?{lat:10*Math.random()-5+30,lng:20*Math.random()-10+110}:n.includes("brazil")||n.includes("mexico")||n.includes("argentina")?{lat:10*Math.random()-5-10,lng:10*Math.random()-5-70}:{lat:.5*(180*Math.random()-90),lng:.5*(360*Math.random()-180)}:null}catch(n){return d.error("Geocoding error:",n),null}},ee=e.useCallback((async()=>{j.current=performance.now(),M(!D);try{const e=new Date;let n=new Date(e);switch(W){case"current-month":default:n.setMonth(n.getMonth()-1);break;case"last-3-months":n.setMonth(n.getMonth()-3);break;case"ytd":n=new Date(e.getFullYear(),0,1)}const a=await c.fetchPOs({startDate:n.toISOString(),endDate:e.toISOString(),limit:100});if(a&&a.data&&a.data.length>0){if(d.info(`Found ${a.data.length} POs for map`),G(a.data.length),await ne(a.data),A(new Date),F(null),b){const e=performance.now()-j.current;b(e)}}else d.info("No POs found"),F("No purchase order data found in the selected date range."),G(0),$([]),A(new Date)}catch(e){d.error("Error fetching purchase orders:",e),F(e instanceof Error?e.message:"Failed to load map data"),G(0),$([])}finally{E(!1),M(!1)}}),[q,Y,W]),ne=async e=>{try{const n=ae(e,q,Y),a=await te(n);if($(a),N&&k&&(se(a),b&&j.current>0)){const e=performance.now()-j.current;d.debug(`[MAP] Markers processed in ${e}ms`)}}catch(n){d.error("Error processing purchase orders:",n),F(n instanceof Error?n.message:"Failed to process map data")}},ae=(e,n,a)=>e.filter((e=>{var n,t,s;if(K){const a=K.toLowerCase();if(!(e.header.poNumber.toLowerCase().includes(a)||(null==(n=e.header.syscoLocation)?void 0:n.name.toLowerCase().includes(a))||(null==(t=e.header.buyerInfo)?void 0:t.firstName.toLowerCase().includes(a))||(null==(s=e.header.buyerInfo)?void 0:s.lastName.toLowerCase().includes(a))))return!1}if("all"!==a){if("pending"===a&&![u.UPLOADED,u.CONFIRMED].includes(e.header.status))return!1;if("in-transit"===a&&![u.SHIPPED].includes(e.header.status))return!1;if("delivered"===a&&![u.DELIVERED,u.INVOICED].includes(e.header.status))return!1}return!0})),te=async e=>{const n=e.filter((e=>e.header&&e.header.syscoLocation&&e.header.syscoLocation.name)),a=[];for(let t=0;t<n.length;t+=5){const e=n.slice(t,t+5);(await Promise.all(e.map((async e=>{var n;try{const a=e.header.syscoLocation.address||e.header.syscoLocation.name,t=await _(a);if(!t)return null;return{id:e.header.poNumber,poNumber:e.header.poNumber,lat:t.lat,lng:t.lng,status:e.header.status,location:e.header.syscoLocation.name,totalCost:e.totalCost,deliveryDate:null==(n=e.header.deliveryInfo)?void 0:n.date,selected:B.includes(e.header.poNumber)}}catch(a){return d.error(`Error processing PO ${e.header.poNumber}:`,a),null}})))).forEach((e=>{null!==e&&a.push(e)}))}return"all"!==q?a.filter((e=>{var n,a;return(n=e.lat,a=e.lng,n>=15&&n<=70&&a>=-170&&a<=-50?"north-america":n>=35&&n<=70&&a>=-10&&a<=40?"europe":n>=-50&&n<=70&&a>=60&&a<=180||n>=-50&&n<=70&&a>=-180&&a<=-130?"asia-pacific":n>=-60&&n<=32&&a>=-120&&a<=-30?"latin-america":"other")===q})):a},se=e.useCallback((e=>{if(!N||!k)return;k.clearLayers();const n=m.layerGroup();if(e.forEach((e=>{const a=m.divIcon({className:`map-marker status-${e.status.toLowerCase()} ${e.selected?"selected":""}`,html:`<div style="background-color: ${ce(e.status)}; ${e.selected?"border: 3px solid #FFC107;":""}"></div>`,iconSize:[24,24],iconAnchor:[12,12]}),t=m.marker([e.lat,e.lng],{icon:a}).on("click",(n=>{T?(re(e.poNumber),n.originalEvent.stopPropagation()):oe(e)}));n.addLayer(t)})),k.addLayer(n),e.length>0)try{const n=m.featureGroup(e.map((e=>m.marker([e.lat,e.lng])))).getBounds();(e.length>1||N.getZoom()<4)&&N.fitBounds(n,{padding:[50,50],maxZoom:10})}catch(a){d.error("Error fitting bounds:",a)}}),[N,k,T,B]),re=e=>{$((n=>n.map((n=>n.poNumber===e?{...n,selected:!n.selected}:n)))),R((n=>{const a=n.includes(e)?n.filter((n=>n!==e)):[...n,e];return f&&f(a),a}))},ie=()=>{V((e=>!e)),T&&le()},le=()=>{R([]),$((e=>e.map((e=>({...e,selected:!1}))))),f&&f([])};e.useEffect((()=>{if(!y.current)return;j.current=performance.now();const{center:e,zoom:n}=X(q),a=m.map(y.current).setView(e,n);m.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a);const t=m.layerGroup().addTo(a);return w(a),C(t),ee(),d.debug(`[MAP] Map initialized in ${performance.now()-j.current}ms`),()=>{a.remove(),w(null),C(null)}}),[]),e.useEffect((()=>{if(N&&k){j.current=performance.now();const{center:e,zoom:n}=X(q);N.setView(e,n),ee()}}),[q,Y,W,ee]),e.useEffect((()=>{if(O.length>0&&N&&k){const e=performance.now();se(O),d.debug(`[MAP] Markers updated in ${performance.now()-e}ms`)}}),[B,O,se]);const oe=e=>{S&&S.remove();const n=m.popup().setLatLng([e.lat,e.lng]).setContent(`\n        <div class="marker-info-popup">\n          <h6>${e.poNumber}</h6>\n          <div class="mb-2">\n            <span class="status-badge ${e.status.toLowerCase()}">${e.status}</span>\n          </div>\n          <div class="mb-1"><strong>Location:</strong> ${e.location}</div>\n          <div class="mb-1"><strong>Total:</strong> ${ue(e.totalCost)}</div>\n          ${e.deliveryDate?`<div class="mb-1"><strong>Delivery:</strong> ${de(e.deliveryDate)}</div>`:""}\n          <div class="d-flex justify-content-between mt-2">\n            <button class="select-po-btn">\n              ${e.selected?"Deselect":"Select"}\n            </button>\n            <button class="view-details-btn">View Details</button>\n          </div>\n        </div>\n      `).openOn(N);setTimeout((()=>{const a=document.querySelector(".view-details-btn");a&&a.addEventListener("click",(()=>{x&&x(e.poNumber)}));const t=document.querySelector(".select-po-btn");t&&t.addEventListener("click",(()=>{re(e.poNumber),n.close()}))}),0),L(n)},ce=e=>{switch(e){case u.UPLOADED:return"#FF9800";case u.CONFIRMED:return"#2196F3";case u.SHIPPED:return"#673AB7";case u.INVOICED:return"#3F51B5";case u.DELIVERED:return"#4CAF50";case u.CANCELLED:return"#F44336";default:return"#9E9E9E"}},de=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(n){return e}},ue=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),me=e=>{if(H(e),b){const e=performance.now();j.current=e}},he=e=>{Z(e)},pe=e=>{J(e)};return D?n.jsx("div",{className:`geographic-map ${v}`,children:n.jsx(a,{className:"h-100 shadow-sm",children:n.jsx(a.Body,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"500px"},children:n.jsxs("div",{className:"text-center",children:[n.jsx(t,{animation:"border",variant:"primary"}),n.jsx("p",{className:"mt-3 text-muted",children:"Loading map data..."}),n.jsx("p",{className:"text-muted small",children:"This may take a moment while we geocode locations."})]})})})}):n.jsxs("div",{className:`geographic-map ${v}`,children:[n.jsxs(a,{className:"h-100 shadow-sm",children:[n.jsxs(a.Header,{className:"bg-light py-3",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[n.jsxs("h5",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-geo-alt me-2"}),"Geographic Map"]}),n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsxs(s,{bg:"primary",className:"me-3 py-2 px-3",children:[O.length," POs shown ",U!==O.length?`(filtered from ${U})`:""]}),B.length>0&&n.jsxs(s,{bg:"success",className:"me-3 py-2 px-3",children:[B.length," POs selected"]}),n.jsxs("div",{className:"text-muted small me-3",children:[n.jsx("i",{className:"bi bi-clock me-1"}),"Last updated: ",(ge=z,ge?ge.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):"Never")]}),n.jsx(r,{variant:"outline-primary",size:"sm",onClick:ee,disabled:I,className:"me-1",children:I?n.jsxs(n.Fragment,{children:[n.jsx(t,{animation:"border",size:"sm",className:"me-1"}),"Refreshing..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-arrow-repeat me-1"})," Refresh"]})})]})]}),n.jsxs("div",{className:"d-flex flex-wrap align-items-center mt-2 gap-2",children:[n.jsx("div",{className:"flex-grow-1 me-2",children:n.jsx(i.Control,{type:"text",placeholder:"Search by PO #, location, or buyer",value:K,onChange:e=>Q(e.target.value)})}),n.jsxs(l,{children:[n.jsxs(l.Toggle,{variant:"outline-secondary",size:"sm",children:[n.jsx("i",{className:"bi bi-globe me-1"}),"all"===q?"All Regions":"north-america"===q?"North America":"europe"===q?"Europe":"asia-pacific"===q?"Asia Pacific":"Latin America"]}),n.jsxs(l.Menu,{children:[n.jsx(l.Item,{active:"all"===q,onClick:()=>me("all"),children:"All Regions"}),n.jsx(l.Item,{active:"north-america"===q,onClick:()=>me("north-america"),children:"North America"}),n.jsx(l.Item,{active:"europe"===q,onClick:()=>me("europe"),children:"Europe"}),n.jsx(l.Item,{active:"asia-pacific"===q,onClick:()=>me("asia-pacific"),children:"Asia Pacific"}),n.jsx(l.Item,{active:"latin-america"===q,onClick:()=>me("latin-america"),children:"Latin America"})]})]}),n.jsxs(l,{children:[n.jsxs(l.Toggle,{variant:"outline-secondary",size:"sm",children:[n.jsx("i",{className:"bi bi-funnel me-1"}),"all"===Y?"All Statuses":"pending"===Y?"Pending":"in-transit"===Y?"In Transit":"Delivered"]}),n.jsxs(l.Menu,{children:[n.jsx(l.Item,{active:"all"===Y,onClick:()=>he("all"),children:"All Statuses"}),n.jsx(l.Item,{active:"pending"===Y,onClick:()=>he("pending"),children:"Pending"}),n.jsx(l.Item,{active:"in-transit"===Y,onClick:()=>he("in-transit"),children:"In Transit"}),n.jsx(l.Item,{active:"delivered"===Y,onClick:()=>he("delivered"),children:"Delivered"})]})]}),n.jsxs(l,{children:[n.jsxs(l.Toggle,{variant:"outline-secondary",size:"sm",children:[n.jsx("i",{className:"bi bi-calendar me-1"}),"current-month"===W?"Current Month":"last-3-months"===W?"Last 3 Months":"ytd"===W?"Year to Date":"Custom"]}),n.jsxs(l.Menu,{children:[n.jsx(l.Item,{active:"current-month"===W,onClick:()=>pe("current-month"),children:"Current Month"}),n.jsx(l.Item,{active:"last-3-months"===W,onClick:()=>pe("last-3-months"),children:"Last 3 Months"}),n.jsx(l.Item,{active:"ytd"===W,onClick:()=>pe("ytd"),children:"Year to Date"}),n.jsx(l.Item,{active:"custom"===W,onClick:()=>pe("custom"),children:"Custom Range"})]})]}),n.jsxs(r,{variant:T?"primary":"outline-secondary",size:"sm",onClick:ie,children:[n.jsx("i",{className:`bi bi-${T?"check-square":"square"} me-1`}),T?"Selection Mode On":"Select POs"]}),B.length>0&&n.jsxs(r,{variant:"outline-danger",size:"sm",onClick:le,children:[n.jsx("i",{className:"bi bi-x-circle me-1"}),"Clear Selection"]}),n.jsxs("div",{className:"btn-group ms-auto",role:"group","aria-label":"Zoom controls",children:[n.jsx(r,{variant:"outline-secondary",size:"sm",onClick:()=>null==N?void 0:N.zoomIn(),children:n.jsx("i",{className:"bi bi-plus"})}),n.jsx(r,{variant:"outline-secondary",size:"sm",onClick:()=>null==N?void 0:N.zoomOut(),children:n.jsx("i",{className:"bi bi-dash"})})]})]})]}),n.jsxs(a.Body,{className:"p-0",children:[P&&n.jsx(o,{variant:"warning",className:"m-3 mb-0",dismissible:!0,onClose:()=>F(null),children:n.jsx("small",{children:P})}),T&&n.jsx(o,{variant:"info",className:"m-3 mb-0",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsxs("small",{children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),"Selection mode is active. Click on markers to select/deselect POs for batch operations."]}),n.jsx(r,{variant:"outline-info",size:"sm",onClick:ie,children:"Exit Selection Mode"})]})}),n.jsx("div",{className:"map-container",children:n.jsx("div",{ref:y,style:{height:"500px",width:"100%"}})}),n.jsxs("div",{className:"map-legend-container d-flex justify-content-between mt-2 px-3 py-2 bg-light",children:[n.jsxs("div",{className:"d-flex flex-wrap gap-3",children:[Object.values(u).map((e=>n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("div",{className:"rounded-circle me-1",style:{width:"12px",height:"12px",backgroundColor:ce(e)}}),n.jsx("span",{className:"small",children:e})]},e))),n.jsxs("div",{className:"d-flex align-items-center ms-3",children:[n.jsx("div",{className:"rounded-circle me-1",style:{width:"16px",height:"16px",backgroundColor:"#3F51B5",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:"white",fontWeight:"bold"},children:"n"}),n.jsx("span",{className:"small",children:"Cluster"})]})]}),n.jsxs("div",{className:"small text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),O.length," POs displayed â€¢ Click on markers for details"]})]})]})]}),n.jsx("style",{children:"\n          .map-marker div {\n            width: 100%;\n            height: 100%;\n            border-radius: 50%;\n            border: 2px solid white;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n          }\n          \n          .map-marker.selected div {\n            border: 3px solid #FFC107 !important;\n            box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);\n          }\n          \n          .marker-info-popup h6 {\n            margin-bottom: 0.5rem;\n          }\n          \n          .marker-info-popup .status-badge {\n            display: inline-block;\n            padding: 2px 6px;\n            border-radius: 4px;\n            font-size: 0.75rem;\n            font-weight: bold;\n            color: white;\n          }\n          \n          .marker-info-popup .status-badge.uploaded { background-color: #FF9800; }\n          .marker-info-popup .status-badge.confirmed { background-color: #2196F3; }\n          .marker-info-popup .status-badge.shipped { background-color: #673AB7; }\n          .marker-info-popup .status-badge.invoiced { background-color: #3F51B5; }\n          .marker-info-popup .status-badge.delivered { background-color: #4CAF50; }\n          .marker-info-popup .status-badge.cancelled { background-color: #F44336; }\n          \n          .marker-info-popup .view-details-btn,\n          .marker-info-popup .select-po-btn {\n            padding: 2px 8px;\n            background-color: #3F51B5;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 0.75rem;\n          }\n          \n          .marker-info-popup .select-po-btn {\n            background-color: #6c757d;\n          }\n        "})]});var ge};export{h as default};
//# sourceMappingURL=GeographicMap-DYaEOUa3.js.map
